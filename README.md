# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

Карточка товара

```
export interface ICard {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number|null;
}
```

Данные покупателя

```

export interface IOrderInfo {
  payment: 'online'|'offline';
  email: string;
  phone: string;
  address: string;
  total: number|null;
  items: string[];
}

```

Интерфейс для модели данных карточек

```
export interface ICardData {
  cards: ICard[];
  preview: string | null;
}
```

Интерфейс для модели данных корзины

```
export interface IBasketModel {
  items: TItems;
  add(id: string): void;
  remove(id: string): void;
}
``` 

## Архитектура приложения 

Код приложения разделен на слои согласно парадигме MVP:
- слой представления отвечает за отображение данных на странице.
- слой данных отвечает за хранение и изменение данных
- presenter отвечает за связь представления и данных

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов. 
Методы:
- `get` - выполняет GET запрос на переданный эндпоинт и возвращает промис с объектом, который вернул сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на эндпоинт, переданный как параметр при вызове метода. По умолчанию выполняется POST запрос, но метод запроса можно переопределить, задав третий параметр

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на них. Испрользуется в presenter для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемыее классом описаны в интерфейса IEvents:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие. 

### Слой данных

#### Класс CardsData
Класс отвечает за хранение и логику работы с данными карточек товаров, полученных с сервера.  
Конструктор класса принимает инстант брокера событий.  
В полях класса хранятся следующие данные: 
  - cards: ICard[] - массив объектов карточек
  - events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

  Также класс предоставляет набор методов для взаимодействия с этими данными:
  - getCard(cardId: string): ICard - возвращает карточку по id
  - changeAddStatus(id: string): void - меняет статус добавления указанной карты в корзину.
  - getAddedCards(): ICard[] - возвращает массив карточек, добавленных в корзину.
  - getAddedCardsList(): TItems - возвращает список карточек, добавленных в корзину.
  - getBasketTotal(): number - возвращает суммарную стоимость доваров, добавленных в корзину.
  - clearBusket(): void - очищает корзину

#### Класс OrderData

Класс отвечает за хранение и логику работы с данными покупателя.  
Конструктор принимает инстант брокера событий.
В полях класса хранятся следующие данные:
- _payment: TPayment - способ оплаты
- _email: string - email покупателя
- _phone: string - номер телефона покупателя
- _address: string - адрес доставки
- _total: TCost - полная стоимость заказа
- _items: string[] - список выбранных товаров
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Также класс предоставляет методы для работы с этими данными
- getOrderInfo():IOrder - возвращает данные покупателя, необходимые для оформления заказа
- checkValidation(): boolean - проверяет объект с данными покупателя на валидность
- clear(): void - очищает данные пользователя при срабатывании соответствующих событий
- setOrderInfo(data: IOrderInfo): void - принимает объект с данными пользователя (полными или частичными) и устанавливает их в соответствующие поля



### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элементр) передаваемых данных.

#### Класс Modal
Реализует модальное окно. Также предоставляет методы open и close для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа. И устанавливает слушатель на submit, с коллбэком в зависимости от модального окна.
- constructor(selector: string, events: IEvents) Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса EventEmitter для инициации событий. 

Поля классаЖ
- modal: HTMLElement - элементр модального окна
- events: IEvents - брокер событий
- submitButton: HTMLButtonElement - кнопка подтверждения.

#### Класс ModalWithItem
Реализует модальное окно товара, который пользователь выбрал на странице. При открытии модального окна, получает карточку товара для отображения. При сабмите товар добавляется в корзину.

Методы:
- open(card?: HTMLElement): void - расширение родительского метода принимает отрендеренный элемент карточки товара и отображает
- get form(): HTMLElement - геттер для получения элемента формы

#### Класс ModalWithBusket
Реализует модальное окно корзины товаров, которые покупатель добавил в корзину. При открытии окна, получает элемент со списком товаров.
При сабмите инициируется событие начала оформления заказа.
Поля класса:
- itemList: HTMLElement - элемент со списком товаров
- totalCost: HTMLElement - элемент с суммарной стоимостью товаров
- submitButton: HTMLButtonElement - кнопка подтверждения.


Методы:
- open(items: HTMLElement): void - расширение родительского метода, принимает элемент списка товаров и их суммарную стоимость для отображения


#### Класс ModalWithForm
Реализует модальное окно формы. Содержит поля ввода и кнопку подтверждения.
Поля класса:
- submitButton: HTMLButtonElement - кнопка подтверждения
- inputs: NodeListOf<HTMLInputElement> - список инпутов

Методы:
- getInputValues() - возвращает объект со значениями полей ввода
- checkValidation():boolean - проводит валидацию формы
-  open() - расширяет родительский метод, вызывает очистку формы при открытии.
- clear() - очищает форму

#### Класс ModalWithOrderForm
Реализует модальное окно формы заказа. Содержит поле ввода и кнопки для выбора способа оплаты. При сабмите инициирует событие указания информации по заказу и передает объект с указанными в форме данными.
Поля класса:
- paymentButtons: NodeListOf<HTMLButtonElement> - кнопки для выбора способа оплаты
- payment: TPayment - выбранный способ оплаты

Методы:
- setPaymentButtons(selectedButton?: HTMLButtonElement) - если передана кнопка, то делает ее активной, если кнопка не передана, то делает неактивными обе.
- checkValidation():boolean - проводит валидацию формы и возвращает true или false
- clear() - расширяет родительский метод для корректной очистки данной формы



#### Класс ModalWithContactsForm
Расширяет родительский метод ModalWithForm, собственных полей и методов не имеет.
Отличается только конструктор.


#### Класс ModalWithOrderComplete
Реализует модальное окно формы указания контактной информации. Содержит информацию о сумме, списанной за заказ.
При сабмите окно закрывается.

- button: HTMLButtonElement - кнопка подтверждения.
- orderSuccessDescription: HTMLElement - элемент с суммой, списанной за заказ. 

Методы:
- open(items?: HTMLElement): void - расширение родительского метода, принимает сумму списанную за заказ для отображения.

#### Абстрактный каласс Card
Отвечает за отображение карточки, задавая в карточке данные названия, изображения, стоимость, категорию товара, описание товара, возможность добавить в корзину(если уже добавлено в корзину, то еще раз добавить нельзя). Используется для отображения карточек на главной странице, в модальном окне добавления в корзину и при просмотре корзины. В конструктор класса передается DOM элемент темплейта, что позволяет формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.  
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр EventEmitter для инициации событий.  
Методы:
- render(CardData: ICard): HTMLElement - принимает объект карточки и возвращает заполненную карточку с установленными слушателями
- get id(): string - возвращает id карточки

#### Класс CardCatalog
Отвечает за отображение карточки в каталогеж
Поля:
- category: HTMLSpanElement - элемент с категорией товара
- image: HTMLImageElement - элемент с изображением товара
Методы:
- render(CardData: ICard) - расширяет родительский метод. Также принимает объект карточки и возвращает элемент карточки.

#### Класс CardInBasket
Отвечает за отображение карточки в корзине
Поля:
- index: HTMLSpanElement - элемент с индексом карточки
- deleteButton: HTMLButtonElement - элемент с кнопкой удаления карточки
Методы:
-render(CardData: ICard) - расширяет родительский метод. Также принимает объект карточки и возвращает элемент карточки.

#### Класс CardPreview
Отвечает за отображение карточки в крупном формате в отдельном модальном окне.
Поля:
- category: HTMLSpanElement - элемент с категорией карточки
- description: HTMLElement - элемент с описанием карточки
- addButton: HTMLButtonElement - элемент с кнопкой добавления карточки в корзину
- image: HTMLImageElement - элемент с изображением карточки
Методы:
- render(CardData: ICard) - расширяет родительский метод. Также принимает объект карточки и возвращает элемент карточки.
- setAddStatus(status:boolean) - устанавливает текст кнопки добавления карточки, в зависимости от того, добавлена, ли она уже в корзину.
- changeAddStatus() - переключает текст кнопки добавления в корзину между двумя вариантами


#### Класс CardsContainer
Отвечает за отображение блока с карточками на главной странице. Предоставляет сеттер catalog для полнгого обновления содержимого. В конструктор принимает контейнер, в котором размещаются карточки.

#### Класс Busket
Отвечает за отображение количества товаров на иконке  корзины на главной странице. Принимает количество товаров и отображает их.
Поля:
- basketCounter: HTMLElement - элемент со счетчиком количества товаров. 
- events: IEvents - экземпляр ивент эмиттера.


### Слой коммуникации

#### Класс ShopAPI
Принимает в конструктор экземпляр класса Api и предоставляет методы, реализующие взаимодействие с бэкэндом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.  
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`.  
В `index.ts` с начала сознаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

Список всех событий, которые могут генерироваться в системе:
События изменения данных (генерируются моделями данных)
- `basket:changed` - изменение массива товаров в корзине 
- `cards:uploaded` - загрузка данных всех карточек в модель 


События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, которые отвечают за представление)
- `card:select` - выбор карточки товара для отображения в модальном окне 
- `card:add` - возникает при сабмите формы, отображающей выбранный товар. Событие добавления карты в корзину. 
- `basket:open` - открытие модального окна корзины
- `basket:submit` - подтверждение выбранных товаров, для дальнейшего оформления заказа и открытие следующего модального окна для продолжения оформления 
- `orderStart:submit` - подтверждение введенных данных для продолжения оформления заказа 
- `orderContacts:submit` - подтверждение введенных данных для оформления заказа 
- `card:delete` - выбор карточки для удаления из корзины 
- `cardInBasket:delete` - выбор карточки для удаления из корзины (при выборе в модальном окне корзины)

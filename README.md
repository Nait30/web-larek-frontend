# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

Карточка товара

```
export interface ICard {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number|null;
}
```

Данные покупателя

```

export interface ICustomerInfo {
  payment: 'online'|'offline';
  email: string;
  phone: string;
  address: string;
  total: number|null;
  items: string[];
}

```

Интерфейс для модели данных карточек

```
export interface ICardData {
  cards: ICard[];
  preview: string | null;
}
```

## Архитектура приложения 

Код приложения разделен на слои согласно парадигме MVP:
- слой представления отвечает за отображение данных на странице.
- слой данных отвечает за хранение и изменение данных
- presenter отвечает за связь представления и данных

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов. 
Методы:
- `get` - выполняет GET запрос на переданный эндпоинт и возвращает промис с объектом, который вернул сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на эндпоинт, переданный как параметр при вызове метода. По умолчанию выполняется POST запрос, но метод запроса можно переопределить, задав третий параметр

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на них. Испрользуется в presenter для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемыее классом описаны в интерфейса IEvents:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие. 

### Слой данных

#### Класс CardsData
Класс отвечает за хранение и логику работы с данными карточек товаров, полученных с сервера.  
Конструктор класса принимает инстант брокера событий.  
В полях класса хранятся следующие данные: 
  - cards: ICard[] - массив объектов карточек
  - preview: string | null - id карточки, выбранной для просмотра(покупки)
  - events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

  Также класс предоставляет набор методов для взаимодействия с этими данными:
  - fill(cards: ICard[]): void - заполняет массив карточек
  - updateCard(card: ICard, payload: Function | null): void обновляет данные о карточке в массиве. Если передан колбэк, то выполняет его после обновления, если нет, то вызывает событие изменения массива.
  - getCard(cardId: string): ICard - возвращает карточку по id

#### Класс CustomerData

Класс отвечает за хранение и логику работы с данными покупателя.  
Конструктор принимает инстант брокера событий.
В полях класса хранятся следующие данные:
- _payment: TPayment - способ оплаты
- _email: string - email покупателя
- _phone: string - номер телефона покупателя
- _address: string - адрес доставки
- _total: TCost - полная стоимость заказа
- _items: string[] - список выбранных товаров

Также класс предоставляет методы для работы с этими данными
- getCustomerInfo():ICustomer - возвращает данные покупателя, необходимые для оформления заказа
- setPayment(payment: TCost): void - устанавливает способ оплаты, выбранный покупателем
- setEmail(email: string): void - устанавливает указанный покупателем email
- setPhone(phone: string): void - устанавливает указанный покупателем номер телефона
- setAddress(address: string): void  - устанавливает указанный покупателем адрес доставки
- setTotalCost(total: TCost): void  - устанавливает суммарную стоимость выбранных пользователем товаров
- setItems(items: string[]): void -  - устанавливает список товаров, заказанных пользователем
- checkValidation(data: Record<keyof (TPaymentInfo|TCustomerContactInfo), string>): boolean - проверяет объект с данными покупателя на валидность
- clear(): void - очищает данные пользователя при срабатывании соответствующих событий

#### Класс BasketModel 
Класс отвечает за хранение и логику работы с товарами в корзине.  
Конструктор класса принимает инстант брокера событий.  
В полях класса хранятся следующие данные:
- items: TItems - список id товаров, находящихся в корзине. 

Также класс предоставляет набор методов для взаимодействия с этими данными:
- add(id: string): void - добавление товара в корзину
- remove(id: string): void - удаление товара из корзины



### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элементр) передаваемых данных.

#### Класс Modal
Реализует модальное окно. Также предоставляет методы open и close для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа. И устанавливает слушатель на submit, с коллбэком в зависимости от модального окна.
- constructor(selector: string, events: IEvents) Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса EventEmitter для инициации событий. 

Поля классаЖ
- modal: HTMLElement - элементр модального окна
- events: IEvents - брокер событий
- submitButton: HTMLButtonElement - кнопка подтверждения.

#### Класс ModalWithItem
Реализует модальное окно товара, который пользователь выбрал на странице. При открытии модального окна, получает карточку товара для отображения. При сабмите товар добавляется в корзину.
Поля класса:
- id: string - id выбранного товара
- _form: HTMLFormElement - элемент формы
- title: HTMLElement - название выбранного товара
- description: HTMLElement - описание товара
- image: HTMLImageElement - элемент картинки с изображением
- category: HTMLSpanElement - элемент с категорией товара
- submitButton: HTMLButtonElement - кнопка подтверждения.

Методы:
- addToBusket(): void - инициирует событие добавления товара в корзину.
- open(item): void - расширение родительского метода принимает объект карточки товара и отображает ее
- get form(): HTMLElement - геттер для получения элемента формы

#### Класс ModalWithBusket
Реализует модальное окно корзины товаров, которые покупатель добавил в корзину. При открытии окна, получает элемент со списком товаров.
При сабмите инициируется событие начала оформления заказа.
Поля класса:
- itemList: HTMLElement - элемент со списком товаров
- totalCost: HTMLElement - элемент с суммарной стоимостью товаров
- submitButton: HTMLButtonElement - кнопка подтверждения.


Методы:
- open(items: HTMLElement): void - расширение родительского метода, принимает элемент списка товаров для отображения
- get form(): HTMLElement - геттер для получения элемента формы

#### Класс ModalWithOrder
Реализует модальное окно формы заказа. Содержит поле ввода и кнопки для выбора способа оплаты. При сабмите инициирует событие указания информации по заказу и передает объект с указанными в форме данными.
Поля класса:
- submitButton: HTMLButtonElement - кнопка подтверждения.
- _form: HTMLFormElement - элемент формы
- orderButtons: HTMLElement - кнопки для выбора способа оплаты заказа
- addressInput: HTMLInputElement - элемент поля ввода адреса

Методы:
- get form(): HTMLElement - геттер для получения элемента формы
- close(): void - расширяет родительский метод, очищая поля ввода при закрытии. 
- getInputValues(): {payment: TPayment, address: string;} - возвращает объект с данными для заказа



#### Класс ModalWithContacts
Реализует модальное окно формы указания контактной информации. Содержит поля для ввода контактов(почта и телефон). При сабмите инициируется событие оформление заказа.

- submitButton: HTMLButtonElement - кнопка подтверждения.
- _form: HTMLFormElement - элемент формы
- emailInput: HTMLInputElement - элемент поля ввода почты
- phoneInput: HTMLInputElement - элемент поля ввода телефона

Методы:
- get form(): HTMLElement - геттер для получения элемента формы
- close(): void - расширяет родительский метод, очищая поля ввода при закрытии. 
- getInputValues(): {email: string, address: string;} - возвращает объект с данными для заказа

#### Класс ModalWithOrderComplete
Реализует модальное окно формы указания контактной информации. Содержит информацию о сумме, списанной за заказ.
При сабмите окно закрывается и инициирует событие завершения заказа.

- submitButton: HTMLButtonElement - кнопка подтверждения.
- _form: HTMLFormElement - элемент формы
- totalCost: HTMLElement - элемент с суммой, списанной за заказ. 

Методы:
- open(items: HTMLElement): void - расширение родительского метода, принимает сумму списанную за заказ для отображения.

#### Класс Card
Отвечает за отображение карточки, задавая в карточке данные названия, изображения, стоимость, категорию товара, описание товара, возможность добавить в корзину(если уже добавлено в корзину, то еще раз добавить нельзя). Используется для отображения карточек на главной странице, в модальном окне добавления в корзину и при просмотре корзины. В конструктор класса передается DOM элемент темплейта, что позволяет формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.  
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр EventEmitter для инициации событий.  
Методы:
- setData(cardData: ICard): void - заполняет атрибуты элементов карточки данными
- render(): HTMLElement - возвращает заполненную карточку с установленными слушателями
- get id(): string - возвращает id карточки
- dleteCard(): void - метод для удаления разметки карточки

#### Класс CardsContainer
Отвечает за отображение блока с карточками на главной странице. Предоставляет метод fill(cardElements: HTMLElement[]) для добавления карточек на страницу и сеттер container для полнгого обновления содержимого. В конструктор принимает контейнер, в котором размещаются карточки.

#### Класс Busket
Отвечает за отображение корзины товаров. Содержит элементы товаров, добавленных в корзину и элемент отображающий количества товаров. Принимает в конструктор контейнер - элемент разметки модального окна с корзиной, элемент для отображения количества товаров в корзине на главной странице и экземпляр EventEmitter для инициации событий при нажатии пользователем на кнопки.  
В полях класса содержатся ссылки на элементы разметки.  
Методы: 
private numberElements(cardElements: HTMLElement[]): HTMLElement[] - добавляет в разметку карточек индексу, соответствующие их порядку в корзине. 
fill(cardElements: HTMLElement[])-  для добавления карточек в корзину. 
setContainer(cardElements: HTMLElement[]) - устанавливает карточки в разметку корзины.
setQuantity(quantity: number|null) - устанавливает данные о количестве товаров в корзине в соответствующем элементе разметки



### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы, реализующие взаимодействие с бэкэндом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.  
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`.  
В `index.ts` с начала сознаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

Список всех событий, которые могут генерироваться в системе:
События изменения данных (генерируются моделями данных)
- `basket:changed` - изменение массива товаров в корзине
- `card:selected` - изменение открываемого в модальном окне товара
- `order:complete` - успешное оформление заказа(получен ответ от сервера, что заказ оформлен)


События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, которые отвечают за представление)
- `card:select` - выбор карточки товара для отображения в модальном окне
- `card:add` - возникает при сабмите формы, отображающей выбранный товар. Событие добавления карты в корзину.
- `basket:open` - открытие модального окна корзины
- `basket:submit` - подтверждение выбранных товаров, для дальнейшего оформления заказа
- `orderStart:open` - открытие модального окна оформления заказа с формой ввода первоначальных данных для оформления
- `orderStart:submit` - подтверждение введенных данных для продолжения оформления заказа
- `orderContacts:open` - открытие модального окна с формой для указания контактов, необходимых для оформления заказа
- `orderContacts:submit` - подтверждение введенных данных для оформления заказа
- `orderComplete:open` - открытие модального окна с информацией об успешном оформлении заказа
- `card:delete` - выбор карточки для удаления из корзины
- `order:finished` - завершение оформления заказа
- `orderFinish:open` - открытие модального окна подтверждения успешного оформления заказа
- `orderForm:input` - изменение данных в формах оформления заказа
- `form:validation` - событие сообщающее о необходимости валидации формы создания новой карточки.
- `forms:clear` - необходима очистка данных форм. 
- `customer:changed` - возникает при внесении данных для заказа покупателем. 